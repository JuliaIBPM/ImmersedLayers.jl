<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Multiple bodies · ImmersedLayers.jl</title><meta name="title" content="Multiple bodies · ImmersedLayers.jl"/><meta property="og:title" content="Multiple bodies · ImmersedLayers.jl"/><meta property="twitter:title" content="Multiple bodies · ImmersedLayers.jl"/><meta name="description" content="Documentation for ImmersedLayers.jl."/><meta property="og:description" content="Documentation for ImmersedLayers.jl."/><meta property="twitter:description" content="Documentation for ImmersedLayers.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ImmersedLayers.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../caches/">Immersed layer caches</a></li><li><a class="tocitem" href="../surfaceops/">Surface-grid operations</a></li><li class="is-active"><a class="tocitem" href>Multiple bodies</a><ul class="internal"><li><a class="tocitem" href="#Body-by-body-calculations"><span>Body-by-body calculations</span></a></li><li><a class="tocitem" href="#Copying-data-body-by-body"><span>Copying data body by body</span></a></li></ul></li><li><a class="tocitem" href="../gridops/">Grid operations</a></li><li><a class="tocitem" href="../helmholtz/">Helmholtz decomposition</a></li><li><a class="tocitem" href="../matrices/">Matrix operators</a></li><li><a class="tocitem" href="../dirichlet/">A Dirichlet Poisson problem</a></li><li><a class="tocitem" href="../utilities/">Utilities</a></li></ul></li><li><span class="tocitem">Setting up PDEs</span><ul><li><a class="tocitem" href="../problems/">Problems and the system</a></li><li><a class="tocitem" href="../neumann/">Poisson with Neumann conditions</a></li><li><a class="tocitem" href="../stokes/">Stokes flow</a></li><li><a class="tocitem" href="../heatconduction/">Setting up a time-varying PDE</a></li><li><a class="tocitem" href="../heatconduction-unbounded/">A time-varying PDE with forcing</a></li><li><a class="tocitem" href="../heatconduction-neumann/">A time-varying PDE with Neumann conditions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Basics</a></li><li class="is-active"><a href>Multiple bodies</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Multiple bodies</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ImmersedLayers.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ImmersedLayers.jl/blob/main/test/literate/multbodies.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Multiple-bodies"><a class="docs-heading-anchor" href="#Multiple-bodies">Multiple bodies</a><a id="Multiple-bodies-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-bodies" title="Permalink"></a></h1><p>Under the hood, the cache uses the concept of a <code>Body</code> (from the <code>RigidBodyTools.jl</code> package) to perform certain calculations, like normal vectors and surface panel areas, which may specialize depending on the type of body shape. Note that most immersed layer operations do not depend on whether there is one or more bodies; rather, they only depend on the discrete points, and their associated normals and areas. However, some post-processing operations, like surface integrals, do depend on distinguishing one body from another. For this reason, the cache stores points in a <code>BodyList</code>, and several operations can exploit this.</p><pre><code class="language-julia hljs">using ImmersedLayers
using Plots</code></pre><p>For the demonstration, we use the same grid.</p><pre><code class="language-julia hljs">Δx = 0.01
Lx = 4.0
xlim = (-Lx/2,Lx/2)
ylim = (-Lx/2,Lx/2)
g = PhysicalGrid(xlim,ylim,Δx)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PhysicalGrid{2}((408, 408), (204, 204), 0.01, ((-2.0300000000000002, 2.0300000000000002), (-2.0300000000000002, 2.0300000000000002)), 2)</code></pre><p>We will create a 2 x 2 array of circles, each of radius 0.5, centered at <span>$(1,1)$</span>, <span>$(1,-1)$</span>, <span>$(-1,1)$</span>, <span>$(-1,-1)$</span>.</p><pre><code class="language-julia hljs">RadC = 0.5
Δs = 1.4*cellsize(g)
body = Circle(RadC,Δs)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Circular body with 224 points and radius 0.5
   Current position: (0.0,0.0)
   Current angle (rad): 0.0
</code></pre><p>We set up the body list by pushing copies of the same body onto the list. (We use <code>deepcopy</code> to ensure that these are copies, rather than pointers to the same body.)</p><pre><code class="language-julia hljs">bl = BodyList()
push!(bl,deepcopy(body))
push!(bl,deepcopy(body))
push!(bl,deepcopy(body))
push!(bl,deepcopy(body))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Body}:
 Circular body with 224 points and radius 0.5
   Current position: (0.0,0.0)
   Current angle (rad): 0.0

 Circular body with 224 points and radius 0.5
   Current position: (0.0,0.0)
   Current angle (rad): 0.0

 Circular body with 224 points and radius 0.5
   Current position: (0.0,0.0)
   Current angle (rad): 0.0

 Circular body with 224 points and radius 0.5
   Current position: (0.0,0.0)
   Current angle (rad): 0.0
</code></pre><p>Now we move them into position. We also use a <code>RigidTransform</code> for each, which we also assemble into a list. (The <code>!</code> is for convenience, using Julia convention, to remind us that each transform operates in-place on the body.)</p><pre><code class="language-julia hljs">t1 = MotionTransform([1.0,1.0],0.0)
t2 = MotionTransform([1.0,-1.0],0.0)
t3 = MotionTransform([-1.0,1.0],0.0)
t4 = MotionTransform([-1.0,-1.0],0.0)
tl = MotionTransformList([t1,t2,t3,t4])</code></pre><p>Finally, we apply the transform. We can apply the transform list directly to the body list:</p><pre><code class="language-julia hljs">update_body!(bl,tl)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Ellipse{224}}:
 Circular body with 224 points and radius 0.5
   Current position: (1.0,1.0)
   Current angle (rad): 0.0

 Circular body with 224 points and radius 0.5
   Current position: (1.0,-1.0)
   Current angle (rad): 0.0

 Circular body with 224 points and radius 0.5
   Current position: (-1.0,1.0)
   Current angle (rad): 0.0

 Circular body with 224 points and radius 0.5
   Current position: (-1.0,-1.0)
   Current angle (rad): 0.0
</code></pre><p>Now we can create the cache, and inspect it by plotting</p><pre><code class="language-julia hljs">cache = SurfaceScalarCache(bl,g,scaling=GridScaling)
plot(cache,xlims=(-2,2),ylims=(-2,2))</code></pre><img src="b8bdd9a2.svg" alt="Example block output"/><h2 id="Body-by-body-calculations"><a class="docs-heading-anchor" href="#Body-by-body-calculations">Body-by-body calculations</a><a id="Body-by-body-calculations-1"></a><a class="docs-heading-anchor-permalink" href="#Body-by-body-calculations" title="Permalink"></a></h2><p>We can now perform operations on data that exploit the division into distinct bodies. For example, let&#39;s compute the integral of <span>$\mathbf{x}\cdot\mathbf{n}$</span>, for body 3. For any of the bodies, this integral should be approximately equal to the area enclosed by the body (or volume in 3-d), multiplied by 2 (or 3 in 3-d). For a circle of radius <span>$1/2$</span>, this area is <span>$\pi/4$</span>, so we expect the result to be nearly <span>$\pi/2$</span>. We use the <code>pointwise_dot</code> operation in <code>CartesianGrids.jl</code> to perform the dot product at each point.</p><pre><code class="language-julia hljs">pts = points(cache)
nrm = normals(cache)
V3 = integrate(pointwise_dot(pts,nrm),cache,3)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1.5708993266236526</code></pre><p>We can also integrate <code>VectorData</code> over individual bodies, and the result is simply a vector with the integral in each coordinate direction. Let&#39;s demonstrate on another geometric integral, this time of <span>$(\mathbf{x}\cdot\mathbf{x})\mathbf{n}$</span>, This integral, when divided by the enclosed area (volume) of the body, is equal to the centroid of the body. Let&#39;s demonstrate on body 3, which we expect to be centered at (-1,1)</p><pre><code class="language-julia hljs">Xc = integrate(pointwise_dot(pts,pts)∘nrm,cache,3)/V3</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Float64}:
 -0.9999999999999997
  0.9999999999999988</code></pre><p>Other operations we can perform body-by-body are <a href="../caches/#LinearAlgebra.dot-Tuple{GridData, GridData, BasicILMCache}"><code>dot</code></a> and <a href="../caches/#LinearAlgebra.norm-Tuple{GridData, BasicILMCache}"><code>norm</code></a></p><h2 id="Copying-data-body-by-body"><a class="docs-heading-anchor" href="#Copying-data-body-by-body">Copying data body by body</a><a id="Copying-data-body-by-body-1"></a><a class="docs-heading-anchor-permalink" href="#Copying-data-body-by-body" title="Permalink"></a></h2><p>It is common that we will want to assign values to surface data, one body at a time. For this, we can make use of an extension of the <code>copyto!</code> function. Let&#39;s see some examples. Suppose we wish to set the value of a surface scalar <code>u</code> to the <span>$x$</span> component of the normal vectors for points on body 3, but leave the values zero for all other bodies. Then we just do the following:</p><pre><code class="language-julia hljs">u = zeros_surface(cache)
copyto!(u,nrm.u,cache,3)</code></pre><p>Let&#39;s plot the data to verify this worked</p><pre><code class="language-julia hljs">plot(u)</code></pre><img src="9216a6d6.svg" alt="Example block output"/><p>We can also plot just the data on body 3 (versus the arclength)</p><pre><code class="language-julia hljs">plot(u,cache,bodyid=3,xlabel=&quot;arc length&quot;)</code></pre><img src="41677fb9.svg" alt="Example block output"/><p>It is also possible to use <a href="../caches/#Base.copyto!-Tuple{PointData, PointData, BasicILMCache, Int64}"><code>copyto!</code></a> to copy a vector of just the right size of the subarray associated with the body.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../surfaceops/">« Surface-grid operations</a><a class="docs-footer-nextpage" href="../gridops/">Grid operations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Wednesday 8 November 2023 06:23">Wednesday 8 November 2023</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
